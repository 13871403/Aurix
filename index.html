<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aurix</title>
<style>
body{margin:0;font-family:sans-serif;background:#111;color:#fff}
header{background:#000;padding:10px;text-align:center;font-size:22px}
button{padding:6px 10px;margin:4px;border:none;border-radius:6px;cursor:pointer}
input,textarea{width:100%;padding:6px;margin:4px 0;border-radius:6px;border:none}
.card{background:#1c1c1c;padding:10px;margin:10px;border-radius:10px}
.hidden{display:none}
.nav{position:fixed;bottom:0;width:100%;background:#000;display:flex;justify-content:space-around;padding:8px}
.nav button{background:none;color:#fff}
.menu{position:fixed;left:0;top:0;width:220px;height:100%;background:#222;padding:10px;display:none;overflow:auto}
a{color:#0af}
.small{font-size:12px;color:#aaa}
</style>
</head>
<body>

<header>Aurix</header>

<div id="menu" class="menu">
<button onclick="toggleMenu()">âœ–</button>
<hr>
<button onclick="switchAccount()">ğŸ”„ Ø³ÙˆØ¦ÛŒÚ† Ø§Ú©Ø§Ù†Øª</button>
<button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
<button onclick="support()">ğŸ§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</button>
</div>

<div id="auth">
<h3>Ø«Ø¨Øª Ù†Ø§Ù…</h3>
<input id="r_name" placeholder="Ù†Ø§Ù…">
<input id="r_username" placeholder="Username (English only)">
<input id="r_email" placeholder="Email">
<input id="r_phone" placeholder="Phone (11 digits)">
<button onclick="register()">Ø«Ø¨Øª Ù†Ø§Ù…</button>
<hr>
<h3>ÙˆØ±ÙˆØ¯</h3>
<input id="l_username" placeholder="Username">
<button onclick="login()">ÙˆØ±ÙˆØ¯</button>
</div>

<div id="app" class="hidden">
<button onclick="toggleMenu()">â˜°</button>
<div id="feed"></div>
<div class="nav">
<button onclick="home()">Ø®Ø§Ù†Ù‡</button>
<button onclick="explore()">Ø§Ú©Ø³Ù¾Ù„ÙˆØ±</button>
<button onclick="profile()">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</button>
<button onclick="messages()">Ø¯Ø§ÛŒØ±Ú©Øª</button>
</div>
</div>

<script>
let users=JSON.parse(localStorage.getItem("aurix_users"))||[];
let current=null;

function save(){localStorage.setItem("aurix_users",JSON.stringify(users))}
function validUser(u){return /^[a-zA-Z0-9_]+$/.test(u)}
function validPhone(p){return p.length>=11}

function register(){
if(users.length>=3){alert("Ø­Ø¯Ø§Ú©Ø«Ø± 3 Ø§Ú©Ø§Ù†Øª");return}
let name=r_name.value;
let username=r_username.value;
let email=r_email.value;
let phone=r_phone.value;
if(!validUser(username)){alert("ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ");return}
if(!validPhone(phone)){alert("Ø´Ù…Ø§Ø±Ù‡ Ø­Ø¯Ø§Ù‚Ù„ 11 Ø±Ù‚Ù…");return}
if(users.find(u=>u.phone===phone)){alert("Ø´Ù…Ø§Ø±Ù‡ ØªÚ©Ø±Ø§Ø±ÛŒ");return}
if(users.find(u=>u.username===username)){alert("ÛŒÙˆØ²Ø±Ù†ÛŒÙ… ØªÚ©Ø±Ø§Ø±ÛŒ");return}
users.push({name,username,email,phone,bio:"",note:"",
private:false,followers:[],following:[],blocked:[],
posts:[],stories:[],messages:{}});
save();alert("Ø«Ø¨Øª Ø´Ø¯");
}

function login(){
let u=users.find(x=>x.username===l_username.value);
if(!u){alert("Ú©Ø§Ø±Ø¨Ø± Ù†ÛŒØ³Øª");return}
current=u;
auth.classList.add("hidden");
app.classList.remove("hidden");
home();
}

function logout(){current=null;app.classList.add("hidden");auth.classList.remove("hidden")}
function toggleMenu(){menu.style.display=menu.style.display==="block"?"none":"block"}

function home(){
feed.innerHTML="";
users.forEach(u=>{
if(u.username!==current.username && 
!current.blocked.includes(u.username) &&
!u.blocked.includes(current.username)){
if(u.private && !u.followers.includes(current.username)) return;
u.posts.forEach((p,i)=>{
p.views=p.views||[];
if(!p.views.includes(current.username)) p.views.push(current.username);
feed.innerHTML+=`
<div class="card">
<h4>@${u.username}</h4>
<p>${p.text}</p>
<div class="small">Ø¨Ø§Ø²Ø¯ÛŒØ¯: ${p.views.length}</div>
<button onclick="likePost('${u.username}',${i})">â¤ï¸ ${p.likes||0}</button>
<input placeholder="Ú©Ø§Ù…Ù†Øª" onkeydown="commentPost(event,'${u.username}',${i})">
<div>${(p.comments||[]).join("<br>")}</div>
</div>`;
});
}
});
feed.innerHTML+=`
<div class="card">
<textarea id="newPost" placeholder="Ù¾Ø³Øª Ø¬Ø¯ÛŒØ¯"></textarea>
<button onclick="addPost()">Ø§Ø±Ø³Ø§Ù„</button>
</div>
<div class="card">
<textarea id="newStory" placeholder="Ø§Ø³ØªÙˆØ±ÛŒ Ø¬Ø¯ÛŒØ¯"></textarea>
<button onclick="addStory()">Ø§Ø±Ø³Ø§Ù„ Ø§Ø³ØªÙˆØ±ÛŒ</button>
</div>`;
save();
}

function addPost(){
if(!newPost.value)return;
current.posts.push({text:newPost.value,likes:0,comments:[],views:[]});
save();home();
}

function likePost(user,i){
let u=users.find(x=>x.username===user);
u.posts[i].likes++;
save();home();
}

function commentPost(e,user,i){
if(e.key==="Enter"){
let u=users.find(x=>x.username===user);
u.posts[i].comments.push(current.username+": "+e.target.value);
e.target.value="";
save();home();
}
}

function addStory(){
if(!newStory.value)return;
current.stories.push({text:newStory.value,views:[],likes:0});
save();home();
}

function explore(){
feed.innerHTML="";
users.forEach(u=>{
if(u.username!==current.username){
feed.innerHTML+=`
<div class="card">
<h4>@${u.username}</h4>
<button onclick="follow('${u.username}')">
${current.following.includes(u.username)?"Ø¢Ù†ÙØ§Ù„Ùˆ":"ÙØ§Ù„Ùˆ"}
</button>
<button onclick="block('${u.username}')">Ø¨Ù„Ø§Ú©</button>
<button onclick="openChat('${u.username}')">Ù¾ÛŒØ§Ù…</button>
</div>`;
}
});
}

function follow(username){
let u=users.find(x=>x.username===username);
if(current.following.includes(username)){
current.following=current.following.filter(x=>x!==username);
u.followers=u.followers.filter(x=>x!==current.username);
}else{
current.following.push(username);
u.followers.push(current.username);
}
save();explore();
}

function block(username){
if(!current.blocked.includes(username)){
current.blocked.push(username);
alert("Ø¨Ù„Ø§Ú© Ø´Ø¯");
}
save();explore();
}

function profile(){
feed.innerHTML=`
<div class="card">
<h3>${current.name}</h3>
<p>@${current.username}</p>
<p>Ø¨ÛŒÙˆ: ${current.bio}</p>
<p>Ù†ÙˆØª: ${current.note}</p>
<p>ÙØ§Ù„ÙˆØ±Ù‡Ø§: ${current.followers.length}</p>
<p>ÙØ§Ù„ÙˆÛŒÙ†Ú¯: ${current.following.length}</p>
<label>Ù¾ÛŒØ¬ Ø®ØµÙˆØµÛŒ 
<input type="checkbox" ${current.private?"checked":""}
onchange="current.private=!current.private;save()">
</label>
<textarea id="bioEdit" placeholder="ÙˆÛŒØ±Ø§ÛŒØ´ Ø¨ÛŒÙˆ"></textarea>
<button onclick="editBio()">Ø°Ø®ÛŒØ±Ù‡ Ø¨ÛŒÙˆ</button>
<textarea id="noteEdit" placeholder="ÙˆÛŒØ±Ø§ÛŒØ´ Ù†ÙˆØª"></textarea>
<button onclick="editNote()">Ø°Ø®ÛŒØ±Ù‡ Ù†ÙˆØª</button>
</div>`;
}

function editBio(){current.bio=bioEdit.value;save();profile()}
function editNote(){current.note=noteEdit.value;save();profile()}

function messages(){
feed.innerHTML="<h3>Ø¯Ø§ÛŒØ±Ú©Øª</h3>";
Object.keys(current.messages).forEach(user=>{
feed.innerHTML+=`<div class="card" onclick="openChat('${user}')">@${user}</div>`;
});
}

function openChat(user){
feed.innerHTML=`<h3>Ú†Øª Ø¨Ø§ @${user}</h3>
<div id="chatBox"></div>
<input id="msgInput" placeholder="Ù¾ÛŒØ§Ù…..." onkeydown="sendMsg(event,'${user}')">`;
let msgs=current.messages[user]||[];
chatBox.innerHTML=msgs.join("<br>");
}

function sendMsg(e,user){
if(e.key==="Enter"){
current.messages[user]=current.messages[user]||[];
current.messages[user].push("Ù…Ù†: "+msgInput.value);
let u=users.find(x=>x.username===user);
u.messages[current.username]=u.messages[current.username]||[];
u.messages[current.username].push(current.username+": "+msgInput.value);
msgInput.value="";
save();openChat(user);
}
}

function switchAccount(){
let list=users.map(u=>u.username).join("\n");
let choose=prompt("Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†:\n"+list);
let u=users.find(x=>x.username===choose);
if(u){current=u;home();}
}

function support(){window.location.href="https://rubika.ir/Music_daniyal"}
</script>

</body>
</html>
